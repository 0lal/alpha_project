# =============================================================================
# ALPHA SOVEREIGN - UNIFIED DISASTER RECOVERY & SELF-HEALING PROTOCOLS
# =============================================================================
# Path: alpha_project/config/logic/recovery_protocols.yaml
# Version: 5.0.0-Unified-Sovereign
# Role: The single source of truth for Logic, Storage, and Network resilience.
# Enforcement: WATCHDOG PROCESS (Runs outside the main loop)
# =============================================================================

recovery_system:
  mode: "ACTIVE_DEFENSE"
  
  # [FORENSIC RULE]: ูุงุนุฏุฉ "ุงูุญูููุฉ ุงููุงุญุฏุฉ".
  # ุงูุฐุงูุฑุฉ ุงููุญููุฉ (RAM/DB) ูุดููู ูููุง ุจุนุฏ ุงูุงูููุงุฑ.
  # ุงูููุตุฉ (Exchange) ูุงูุจูููุดูู ููุง ุงููุตุฏุฑ ุงููุญูุฏ ููุญูููุฉ.

# -----------------------------------------------------------------------------
# 1. ๐ COLD START & RECONCILIATION (ุฅุฌุฑุงุกุงุช ุงูุฅููุงุน ูุงูุชุญูู)
# -----------------------------------------------------------------------------
boot_sequence:
  
  # ุชุฏููู ุงูุญุงูุฉ (State Audit)
  # [CRITICAL]: ูู ูุฏููุง ุตููุงุช ููุชูุญุฉ ูุง ูุนุฑู ุนููุง ุดูุฆุงูุ
  reconciliation:
    step_1: "FETCH_OPEN_ORDERS_FROM_EXCHANGE"
    step_2: "FETCH_WALLET_BALANCE_FROM_EXCHANGE"
    step_3: "COMPARE_WITH_LOCAL_DB"
    
    # ุฅุฐุง ูุฌุฏูุง ุงุฎุชูุงูุงู (ูุซูุงู: DB ูููู ูุงุดุ ูุงูููุตุฉ ุชููู ูุฏููุง BTC)
    on_mismatch: 
      action: "TRUST_EXCHANGE_AND_UPDATE_DB"
      log_level: "CRITICAL_FORENSIC_ALERT"

  # ูุญุต ุงููุฌูุฉ ุงูุฒูููุฉ (Time Gap Analysis)
  # ูู ุงูุณูู ุชุญุฑู ุจุฌููู ููุญู ูุงุฆูููุ
  market_gap_check:
    max_allowed_gap_minutes: 60
    
    # ุฅุฐุง ูุงู ุงููุธุงู ุทุงููุงู ูุฃูุซุฑ ูู ุณุงุนุฉ
    action_on_large_gap:
      - "CANCEL_ALL_PENDING_ORDERS"
      - "PAUSE_TRADING_FOR_15_MIN"
      - "RECALCULATE_ALL_INDICATORS"

# -----------------------------------------------------------------------------
# 2. ๐พ STORAGE RESILIENCE (ุญูุงูุฉ ุงูุฐุงูุฑุฉ ูุงูุจูุงูุงุช)
# -----------------------------------------------------------------------------
# [MERGED FROM: config/storage/recovery_map.yaml]
storage_policy:
  
  # ุฃูุฏุงู ุงูุชุนุงูู (RPO/RTO)
  objectives:
    rpo_financial_data: "ZERO_LOSS"        # ูุง ุชุณุงูุญ ูุน ููุฏุงู ุงูุตููุงุช
    rpo_system_logs: "1h"                  # ูููู ููุฏุงู ุณุงุนุฉ ูู ุงูุณุฌูุงุช
    rto_critical_restore: "5m"             # ูุฌุจ ุฃู ุชุนูุฏ ุงููุงุนุฏุฉ ูู 5 ุฏูุงุฆู

  # ูุตูููุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู (Backup Matrix)
  backup_schedule:
    # ุงููุณุฎ ุงูุณุงุฎู (ุงููุญุธู)
    hot_snapshots:
      frequency: "EVERY_1_HOUR"
      retention: "24_HOURS"
      path: "/var/lib/postgresql/data/snapshots"
      compression: "NONE" # ุงูุณุฑุนุฉ ุฃูู
    
    # ุงููุณุฎ ุงูุจุงุฑุฏ (ุทููู ุงูุฃูุฏ)
    cold_archives:
      frequency: "DAILY_AT_0300"
      retention: "90_DAYS"
      path: "data/backups/cold_storage/"
      encryption: "AES-256-GCM"
      compression: "ZSTD_LEVEL_9"

  # ุฎุฑูุทุฉ ุงูุชุฎุฒูู ุงูุจุฏูู (Failover Storage)
  # ุฅุฐุง ุงูุชูุฃ ุงููุฑุต ุงูุฑุฆูุณู
  failover_volumes:
    primary: 
      id: "alpha_db_data"
      status: "ACTIVE"
    emergency_spillover:
      id: "alpha_temp_spill"
      location: "./data/temp_overflow/"
      trigger: "DISK_USAGE > 95%"
      allowed_data: ["LOGS", "CACHE_DUMPS"]

  # ูุนุงูุฌุฉ ูุณุงุฏ ุงูุจูุงูุงุช (Corruption Response)
  corruption_handling:
    minor_index_corruption: "REINDEX_ONLINE"
    major_page_corruption: 
      action: "EMERGENCY_SHUTDOWN"
      recovery: "RESTORE_LAST_VALID_SNAPSHOT"

# -----------------------------------------------------------------------------
# 3. ๐ INFRASTRUCTURE & NETWORK (ุงูุจููุฉ ุงูุชุญุชูุฉ ูุงูุดุจูุฉ)
# -----------------------------------------------------------------------------
# [MERGED FROM: config/network/recovery_map.yaml]
infrastructure_guard:
  
  # ูุฑุงูุจุฉ ุงูุญุงููุงุช (Docker Watchdog)
  container_health:
    check_interval_seconds: 10
    on_failure: "DOCKER_AUTO_RESTART"
    max_restarts: 5

  # ุงูุงูููุงุฑ ุงูุญุฑุงุฑู (Thermal Critical)
  # ุญูุงูุฉ ุงูุฌูุงุฒ ุงููุนูู ูู ุงูุงุญุชุฑุงู
  thermal_protection:
    critical_temp_celsius: 90
    action: "GRACEFUL_SHUTDOWN"
    log_alert: "HARDWARE_HEAT_CRITICAL"

  # ุงููุทุงุน ุงูุงุชุตุงู (Connectivity Loss)
  network_outage:
    # ุงููุทุงุน ูุตูุฑ (< 1 ุฏูููุฉ)
    micro_outage:
      action: "BUFFER_REQUESTS_AND_RETRY"
      retry_strategy: "JITTERED_BACKOFF"
    
    # ุงููุทุงุน ูุชูุณุท (1 - 15 ุฏูููุฉ)
    sustained_outage:
      action: "ENTER_DEFENSIVE_MODE"
      cancel_orders: true
      switch_proxy: "IF_FAILURES > 5 THEN SWITCH_PROVIDER"
    
    # ุงููุทุงุน ุทููู (> 15 ุฏูููุฉ)
    blackout_mode:
      action: "HIBERNATE_AND_ALERT_USER"

  # ุฎุฑูุทุฉ ุงูุนูุฏ (Topology)
  nodes:
    primary_local:
      id: "NODE_ALPHA_GENESIS"
      role: "MASTER_SINGLE"
      location: "LOCAL_WSL2"

# -----------------------------------------------------------------------------
# 4. ๐ค API & DATA INTEGRITY (ุญูุงูุฉ ุงูุนูู)
# -----------------------------------------------------------------------------
data_integrity_guard:
  
  # ุงููุตูู ูุญุฏูุฏ ุงูู API (Rate Limit Jail)
  rate_limit_breach:
    immediate_action: "HALT_ALL_REQUESTS_FOR_60s"
    secondary_action: "SWITCH_TO_WEBSOCKET_ONLY"
    
  # ุงูุจูุงูุงุช ุงููุงุณุฏุฉ (Bad JSON)
  malformed_data:
    tolerance_threshold: 5
    action: "FLUSH_DATA_CACHE_AND_RECONNECT"

# -----------------------------------------------------------------------------
# 5. ๐ง COGNITIVE SAFETY (ุงูุฌููู ุงููุคูุช)
# -----------------------------------------------------------------------------
ai_hallucination_guard:
  
  # ุงูุชุดุงู ุงููููุณุฉ
  triggers:
    - "Model suggests buying price > 20% current price"
    - "Model returns invalid JSON format 3 times"
    - "Model stuck in repetitive loop"
    
  # ุจุฑูุชูููู "ุงุณุชุฆุตุงู ุงููุต ุงูุฌุจูู" (Lobotomy Protocol)
  response:
    step_1: "DISABLE_AI_REASONING_ENGINE"
    step_2: "FALLBACK_TO_HARDCODED_LOGIC (RSI + MACD only)"
    step_3: "NOTIFY_ADMIN_TO_RESET_MODEL"

# -----------------------------------------------------------------------------
# 6. ๐ก๏ธ EMERGENCY LOCKDOWN (ุงูุฅุบูุงู ุงูุฏูุงุนู)
# -----------------------------------------------------------------------------
lockdown_triggers:
  
  # ุงูููุงุฑ ุงููุญูุธุฉ (Equity Drop)
  equity_drop:
    trigger: "Total Equity drops > 10% in 5 minutes"
    action: "LIQUIDATE_POSITIONS_AND_FREEZE_ACCOUNTS"
    
  # ูุดู ุงููุตุงุฏูุฉ (Auth Failure)
  auth_failure:
    trigger: "HTTP 401 Unauthorized"
    action: "DELETE_INVALID_KEYS_AND_WAIT_FOR_USER"

# -----------------------------------------------------------------------------
# 7. ๐ฎ DECENTRALIZED RECOVERY (ุงูููุงุฐ ุงูุฃุฎูุฑ)
# -----------------------------------------------------------------------------
post_collapse_protocol:
  enabled: false
  
  # ุงูุจุญุซ ุนู ุงูุฃููุงู ุนูู ุงูุจูููุดูู ูุจุงุดุฑุฉ
  on_chain_recovery:
    rpc_nodes: ["https://eth.llamarpc.com", "https://btc.getblock.io"]
    wallet_scanner: "ACTIVE"
    emergency_method: "emergencyWithdraw()"