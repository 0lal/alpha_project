// Security Alert Contract

// =================================================================
// ALPHA SOVEREIGN ORGANISM - SECURITY ALERT PROTOCOL
// =================================================================
// File: schemas/proto/shield_alert.proto
// Status: PRODUCTION (Streaming Interface)
// Pillar: Security & Defense (الركيزة: الأمن والدفاع)
// Forensic Purpose: تعريف قناة البث الفوري للإنذارات الأمنية لتمكين رد الفعل الآلي السريع.
// =================================================================

syntax = "proto3";

package alpha.shield.v1;

// خيارات اللغة
option java_multiple_files = true;
option go_package = "github.com/alpha/shield/alert";

// -----------------------------------------------------------------
// 1. تعريف خدمة الحارس (SENTINEL SERVICE)
// -----------------------------------------------------------------
// هذه الخدمة تعمل كبرج مراقبة يبث التحذيرات للمشتركين.

service ShieldSentinel {
  // الاشتراك في تدفق التهديدات (Server Streaming).
  // يفتح العميل الاتصال مرة واحدة، ويظل الخادم يرسل التحذيرات كلما حدثت.
  rpc SubscribeToThreats (AlertSubscription) returns (stream SecurityAlert);

  // الإبلاغ عن حادث أمني يدويًا (من مكون داخلي اكتشف شذوذًا).
  rpc ReportIncident (IncidentReport) returns (ReportAck);
}

// -----------------------------------------------------------------
// 2. رسائل الاشتراك (SUBSCRIPTION MESSAGES)
// -----------------------------------------------------------------

message AlertSubscription {
  // اسم المكون المشترك (مثال: "Trading_Engine_Core").
  string component_id = 1;

  // الحد الأدنى للخطورة التي يريد استلامها.
  // (المحرك المالي قد يهتم فقط بالخطر القاتل FATAL).
  AlertSeverity min_severity = 2;

  // مفتاح المصادقة الداخلي (للتأكد أن المشترك هو جزء من النظام).
  string auth_token = 3;
}

// -----------------------------------------------------------------
// 3. رسالة التنبيه الأمني (THE ALERT)
// -----------------------------------------------------------------

message SecurityAlert {
  // معرف فريد للإنذار (UUID).
  string alert_id = 1;

  // توقيت الكشف (Precision Timestamp).
  string timestamp = 2;

  // مستوى الخطورة.
  AlertSeverity severity = 3;

  // نوع التهديد المكتشف.
  ThreatType type = 4;

  // مصدر التهديد (IP خارجي، ملف مشبوه، أو عملية داخلية).
  string source_identifier = 5;

  // الإجراء الذي اتخذه الدرع تلقائياً.
  MitigationAction action_taken = 6;

  // وصف نصي للمشكلة (للإنسان).
  string description = 7;

  // البيانات الخام للدليل الجنائي (Payload Hex/Text).
  string forensic_evidence = 8;
}

// -----------------------------------------------------------------
// 4. التصنيفات (ENUMERATIONS)
// -----------------------------------------------------------------

enum AlertSeverity {
  INFO = 0;             // معلومة عادية (مثال: فحص دوري).
  WARNING = 1;          // تحذير (مثال: محاولة دخول فاشلة).
  CRITICAL = 2;         // خطر (مثال: اكتشاف حقن SQL أو نمط هجوم).
  FATAL = 3;            // قاتل (مثال: تلاعب في الذاكرة أو كسر التشفير).
}

enum ThreatType {
  UNKNOWN_THREAT = 0;
  NETWORK_DDOS = 1;         // هجوم حجب الخدمة.
  INTRUSION_ATTEMPT = 2;    // محاولة اختراق.
  MALICIOUS_PAYLOAD = 3;    // بيانات خبيثة في المدخلات.
  SYSTEM_INTEGRITY_FAIL = 4; // فشل في التحقق من صحة الملفات (تلاعب).
  UNAUTHORIZED_ACCESS = 5;   // وصول غير مصرح به.
  ANOMALY_BEHAVIOR = 6;      // سلوك شاذ (AI Detection).
}

enum MitigationAction {
  OBSERVE_ONLY = 0;     // مراقبة فقط.
  BLOCK_SOURCE = 1;     // حظر المصدر (IP Ban).
  DROP_PACKET = 2;      // تجاهل الحزمة.
  TERMINATE_SESSION = 3; // إنهاء الجلسة.
  ISOLATE_COMPONENT = 4; // عزل المكون (Docker Pause).
  SYSTEM_LOCKDOWN = 5;   // إغلاق تام للنظام (Panic Mode).
}

// -----------------------------------------------------------------
// 5. رسائل الإبلاغ الداخلي (INTERNAL REPORTING)
// -----------------------------------------------------------------

message IncidentReport {
  string reporter_id = 1;
  ThreatType suspected_type = 2;
  string details = 3;
}

message ReportAck {
  bool received = 1;
  string case_id = 2;
}