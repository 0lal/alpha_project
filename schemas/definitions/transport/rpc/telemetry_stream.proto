// Live Health Data

// =================================================================
// ALPHA SOVEREIGN ORGANISM - BIO-TELEMETRY STREAM PROTOCOL
// =================================================================
// File: schemas/proto/telemetry_stream.proto
// Status: PRODUCTION (High-Frequency Stream)
// Pillar: Observability & Diagnostics (الركيزة: المراقبة والتشخيص)
// Forensic Purpose: قناة موحدة لنقل المؤشرات الحيوية (الصحة، الأداء، الموارد) من الأعضاء إلى مركز المراقبة.
// =================================================================

syntax = "proto3";

package alpha.telemetry.v1;

// خيارات اللغة
option java_multiple_files = true;
option go_package = "github.com/alpha/telemetry/stream";

// -----------------------------------------------------------------
// 1. تعريف خدمة القياس (TELEMETRY SERVICE)
// -----------------------------------------------------------------
// هذه الخدمة تعمل كـ "سماعة الطبيب" التي تسمح للمراقب بالاستماع لنبض النظام.

service TelemetryStreamer {
  // الاشتراك في تدفق البيانات الحيوية (Live Feed).
  // يطلب العميل (Dashboard) مراقبة مكونات معينة، ويستقبل تدفقاً مستمراً من البيانات.
  rpc SubscribeToMetrics (SubscriptionRequest) returns (stream TelemetryPacket);

  // إرسال دفعة بيانات (تستخدمها المكونات الداخلية لإرسال تقاريرها).
  rpc PushMetrics (MetricBatch) returns (PushAck);
}

// -----------------------------------------------------------------
// 2. رسائل الاشتراك (SUBSCRIPTION MESSAGES)
// -----------------------------------------------------------------

message SubscriptionRequest {
  // تصفية حسب المكون (مثال: "Risk_Engine" فقط).
  // اتركها فارغة لاستلام كل شيء (Firehose Mode).
  repeated string component_filters = 1;

  // معدل التحديث المطلوب (Sampling Rate) بالمللي ثانية.
  // 0 = Realtime (أقصى سرعة).
  int32 sampling_interval_ms = 2;
}

// -----------------------------------------------------------------
// 3. حزمة البيانات (DATA PACKET)
// -----------------------------------------------------------------

message TelemetryPacket {
  // مصدر البيانات.
  string source_component = 1;

  // توقيت الارسال (Unix Nanoseconds) لترتيب الأحداث بدقة.
  int64 timestamp_nanos = 2;

  // الحالة الصحية العامة للمكون في هذه اللحظة.
  ComponentHealth health_status = 3;

  // قائمة المقاييس في هذه الحزمة.
  repeated MetricPoint metrics = 4;
}

message MetricPoint {
  // اسم المقياس (مثال: "cpu_usage_percent", "active_trades").
  string name = 1;

  // القيمة (Polymorphic Value) - يمكن أن تكون عدة أنواع.
  oneof value {
    double float_val = 2;   // للنسب المئوية والأسعار.
    int64 int_val = 3;      // للعدادات (عدد الطلبات).
    string string_val = 4;  // للحالات النصية (Status Strings).
    bool bool_val = 5;      // للأعلام (Flags).
  }

  // وحدة القياس (للعرض الصحيح).
  string unit = 6;
  
  // تصنيفات إضافية (Tags) مثل {"host": "server-1", "strategy": "scalping"}.
  map<string, string> tags = 7;
}

message MetricBatch {
  string source_component_id = 1;
  repeated MetricPoint metrics = 2;
}

message PushAck {
  bool accepted = 1;
  int32 processed_count = 2;
}

// -----------------------------------------------------------------
// 4. التصنيفات الصحية (HEALTH ENUMS)
// -----------------------------------------------------------------

enum ComponentHealth {
  UNKNOWN = 0;
  HEALTHY = 1;          // يعمل بكفاءة 100%.
  DEGRADED = 2;         // يعمل ببطء أو أخطاء بسيطة.
  UNHEALTHY = 3;        // أخطاء جوهرية، يتطلب تدخلاً.
  CRITICAL_FAILURE = 4; // توقف تام عن العمل.
}